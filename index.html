
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>ParfumDEPO Miniapp</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 10px; max-width: 600px; margin: auto; }
    h1 { text-align: center; }
    input[type="text"] { width: 100%; padding: 8px; font-size: 16px; margin-bottom: 10px; }
    button { padding: 8px 12px; margin: 5px 0; cursor: pointer; }
    .product { border: 1px solid #ccc; padding: 10px; margin-bottom: 8px; display: flex; align-items: center; }
    .product img { width: 80px; height: 80px; object-fit: cover; margin-right: 10px; }
    .product-details { flex: 1; }
    .product-name { font-weight: bold; font-size: 18px; }
    .product-info { font-size: 14px; color: #555; }
    .cart-btn { background-color: #28a745; color: white; border: none; }
    .cart-btn:hover { background-color: #218838; }
    #cartPage { display: none; }
    .copy-btn { margin-left: 10px; }
  </style>
</head>
<body>

<div id="mainPage">
  <h1>ParfumDEPO</h1>
  <input type="text" id="searchInput" placeholder="Поиск по названию..." />
  <button id="filterBtn">Фильтр: По цене ↑</button>
  <div id="catalog"></div>
  <button id="goToCartBtn" style="margin-top: 15px;">Перейти в корзину</button>
</div>

<div id="cartPage">
  <h1>Корзина</h1>
  <div id="cartList"></div>
  <button id="orderBtn" style="margin-top: 15px;">Оформить заказ у менеджера</button>
  <button id="backBtn" style="margin-top: 15px;">Назад в каталог</button>
</div>

<script>
  // Пример каталога - можно дополнять
  const products = [
    {
      id: 1,
      name: "Dior Sauvage",
      concentration: "EDT",
      volume: "100ml",
      price: 7500,
      img: "https://cdn.scentbird.com/dior-sauvage-100ml.jpg"
    },
    {
      id: 2,
      name: "Chanel No 5",
      concentration: "EDP",
      volume: "50ml",
      price: 8500,
      img: "https://cdn.scentbird.com/chanel-no5-50ml.jpg"
    },
    {
      id: 3,
      name: "Versace Eros",
      concentration: "EDT",
      volume: "100ml",
      price: 6800,
      img: "https://cdn.scentbird.com/versace-eros-100ml.jpg"
    },
  ];

  let filteredProducts = [...products];
  let ascending = true; // флаг сортировки по цене
  let cart = JSON.parse(localStorage.getItem("parfumdepo_cart")) || [];

  // Отрисовка каталога
  function renderCatalog() {
    const catalogDiv = document.getElementById("catalog");
    catalogDiv.innerHTML = "";
    filteredProducts.forEach(product => {
      const div = document.createElement("div");
      div.className = "product";
      div.innerHTML = `
        <img src="${product.img}" alt="${product.name}" />
        <div class="product-details">
          <div class="product-name">${product.name}</div>
          <div class="product-info">Концентрация: ${product.concentration}</div>
          <div class="product-info">Объем: ${pro
duct.volume}</div>
          <div class="product-info">Цена: ${product.price} ₽</div>
        </div>
        <button class="cart-btn" data-id="${product.id}">Добавить в корзину</button>
      `;
      catalogDiv.appendChild(div);
    });

    // Навешиваем обработчик на кнопки добавления в корзину
    document.querySelectorAll(".cart-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        const id = +btn.getAttribute("data-id");
        addToCart(id);
      });
    });
  }

  // Функция добавления в корзину
  function addToCart(productId) {
    const product = products.find(p => p.id === productId);
    if (!product) return;
    // Проверяем есть ли уже в корзине (увеличиваем количество)
    let item = cart.find(c => c.id === productId);
    if (item) {
      item.quantity++;
    } else {
      cart.push({...product, quantity: 1});
    }
    localStorage.setItem("parfumdepo_cart", JSON.stringify(cart));
    alert(`Товар "${product.name}" добавлен в корзину`);
  }

  // Поиск
  document.getElementById("searchInput").addEventListener("input", (e) => {
    const val = e.target.value.toLowerCase();
    filteredProducts = products.filter(p => p.name.toLowerCase().includes(val));
    sortCatalog();
    renderCatalog();
  });

  // Сортировка
  function sortCatalog() {
    filteredProducts.sort((a, b) => ascending ? a.price - b.price : b.price - a.price);
  }

  document.getElementById("filterBtn").addEventListener("click", () => {
    ascending = !ascending;
    document.getElementById("filterBtn").innerText = `Фильтр: По цене ${ascending ? "↑" : "↓"}`;
    sortCatalog();
    renderCatalog();
  });

  // Переход в корзину
  document.getElementById("goToCartBtn").addEventListener("click", () => {
    showCartPage();
  });

  // Показ корзины
  function showCartPage() {
    document.getElementById("mainPage").style.display = "none";
    document.getElementById("cartPage").style.display = "block";
    renderCart();
  }

  // Показ каталога
  function showMainPage() {
    document.getElementById("mainPage").style.display = "block";
    document.getElementById("cartPage").style.display = "none";
  }

  // Отрисовка корзины
  function renderCart() {
    const cartList = document.getElementById("cartList");
    cartList.innerHTML = "";
    if (cart.length === 0) {
      cartList.innerHTML = "<p>Корзина пуста</p>";
      return;
    }
    cart.forEach(item => {
      const div = document.createElement("div");
      div.className = "product";
      div.innerHTML = `
        <img src="${item.img}" alt="${item.name}" />
        <div class="product-details">
          <div class="product-name">${item.name}</div>
          <div class="product-info">Концентрация: ${item.concentration}</div>
          <div class="product-info">Объем: ${item.volume}</div>
          <div class="product-info">Цена: ${item.price} ₽ x ${item.quantity} = ${item.price * item.quantity} ₽</div>
        </div>
        <button class="copy-btn" data-id="${item.id}">Скопировать данные</button>
      `;
      cartList.appendChild
(div);
    });

    // Обработчик копирования
    document.querySelectorAll(".copy-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        const id = +btn.getAttribute("data-id");
        const item = cart.find(c => c.id === id);
        if (!item) return;
        const text = `Товар: ${item.name}\nКонцентрация: ${item.concentration}\nОбъем: ${item.volume}\nЦена: ${item.price} ₽\nКоличество: ${item.quantity}`;
        navigator.clipboard.writeText(text).then(() => {
          alert("Данные скопированы в буфер обмена");
        });
      });
    });
  }

  // Кнопка оформления заказа
  document.getElementById("orderBtn").onclick = () => {
    const url = "https://t.me/parfumdepo";
    // Пытаемся через Telegram WebApp открыть чат с менеджером (если поддерживается)
    if (window.Telegram.WebApp && window.Telegram.WebApp.openTelegramLink) {
      window.Telegram.WebApp.openTelegramLink(url);
    } else {
      window.open(url, "_blank");
    }
  };

  document.getElementById("backBtn").onclick = () => {
    showMainPage();
  };

  // Инициализация
  sortCatalog();
  renderCatalog();

</script>

</body>
</html>
